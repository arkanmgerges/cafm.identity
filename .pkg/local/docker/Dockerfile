FROM python:3.8-slim

RUN pip3 install pipenv
RUN pip3 install hupper

# -- Adding Pipfiles
COPY Pipfile Pipfile Pipfile.lock ./
# -- Install dependencies:
RUN set -ex && pipenv install --deploy --system
COPY . /app

ENV CAFM_IDENTITY_LOGGING=DEBUG
ENV DECORATOR_DEBUGGING_INFO_STATUS=True
ENV CAFM_IDENTITY_LOGGING_MAX_FILE_LINES=7
ENV SECRET_TOKEN=1234
ENV MESSAGE_BROKER_SERVERS='kafka:9092'
ENV KAFKA_PARTITIONS_COUNT_PER_TOPIC=1
ENV MESSAGE_SCHEMA_REGISTRY_URL='http://schema-registry:9001'
ENV CAFM_API_COMMAND_TOPIC='cafm.api.cmd'
ENV CAFM_API_RESPONSE_TOPIC='cafm.api.rsp'
ENV CAFM_API_SERVICE_NAME='cafm.api'
ENV CAFM_IDENTITY_SERVICE_NAME='cafm.identity'
ENV CAFM_IDENTITY_COMMAND_TOPIC='cafm.identity.cmd'
ENV CAFM_IDENTITY_EVENT_TOPIC='cafm.identity.evt'
ENV CAFM_IDENTITY_CONSUMER_GROUP_API_CMD_NAME='cafm.identity.consumer-group.api.cmd'
ENV CAFM_IDENTITY_CONSUMER_GROUP_IDENTITY_CMD_NAME='cafm.identity.consumer-group.identity.cmd'
ENV CAFM_IDENTITY_ARANGODB_URL='http://arangodb:8529'
ENV CAFM_IDENTITY_ARANGODB_USERNAME='root'
ENV CAFM_IDENTITY_ARANGODB_PASSWORD='TmosG@t7tltx^D%0'
ENV CAFM_IDENTITY_ARANGODB_DB_NAME='cafm-identity'
ENV CAFM_JWT_SECRET='cafmpass1234'
ENV CAFM_IDENTITY_REDIS_HOST='redis'
ENV CAFM_IDENTITY_REDIS_PORT=6379
ENV CAFM_IDENTITY_REDIS_SESSION_KEY_PREFIX='cafm.identity.session.'
ENV CAFM_IDENTITY_USER_AUTH_TTL_IN_SECONDS=3600
ENV SENDGRID_API_KEY='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'
